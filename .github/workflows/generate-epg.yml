name: Generate EPG with WebGrab++ (Windows)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'  # TÃ¤glich um 03:00 Uhr

jobs:
  run-webgrab:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install .NET Framework 4.8 (via Chocolatey)
        run: |
          choco install dotnetfx --version=4.8 -y

      - name: Download WebGrab++
        run: |
          Invoke-WebRequest -Uri "https://webgrabplus.com/sites/default/files/download/SW/V3.2/WebGrabPlus_V3.2_install.zip" -OutFile "WebGrabPlus.zip"
          Expand-Archive -Path "WebGrabPlus.zip" -DestinationPath "WebGrab"

      - name: Copy config and SiteIni files
        run: |
          Copy-Item "config\WebGrab++.config.xml" "WebGrab\WebGrab++.config.xml"
          New-Item -ItemType Directory -Path "WebGrab\siteini.pack\Germany" -Force
          Copy-Item "siteini\prisma.de.ini" "WebGrab\siteini.pack\Germany\prisma.de.ini"

      - name: Run WebGrab++
        run: |
          cd WebGrab
          .\WebGrab+Plus.exe

      - name: Upload guide.xml
        uses: actions/upload-artifact@v4
        with:
          name: epg
          path: WebGrab\guide.xml
