name: Generate EPG with WebGrab++ (Windows)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * *'  # TÃ¤glich um 03:00 Uhr

jobs:
  run-webgrab:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install .NET Framework 4.8 (via Chocolatey)
        run: |
          choco install dotnetfx --version=4.8 -y

      - name: Download WebGrab++ V5.3 from Softpedia
        run: |
          Invoke-WebRequest -Uri "https://softpedia-secure-download.com/dl/b36a84f06a82483d199566ab38c3e698/68c358ff/100265333/software/other_tools/WebGrabPlus_V5.3_install.exe" -OutFile "WebGrabPlus.exe"

      - name: Prepare WebGrab++ folder
        run: |
          New-Item -ItemType Directory -Path "WebGrab" -Force
          Move-Item "WebGrabPlus.exe" "WebGrab\WebGrabPlus.exe"
          Copy-Item "config\WebGrab++.config.xml" "WebGrab\WebGrab++.config.xml"
          New-Item -ItemType Directory -Path "WebGrab\siteini.pack\Germany" -Force
          Copy-Item "siteini\prisma.de.ini" "WebGrab\siteini.pack\Germany\prisma.de.ini"

      - name: Run WebGrab++
        run: |
          cd WebGrab
          .\WebGrabPlus.exe

      - name: Upload guide.xml
        uses: actions/upload-artifact@v4
        with:
          name: epg
          path: WebGrab\guide.xml
